
### img 태그의 src 속성에 서버에서 받아온 이미지 경로를 적용해서 미리보기를 하는 화면 구현

- **문제** : 로컬에서는 미리 보기 png 파일이 정상적으로 로딩 되지만, 배포 버전에서는 경로를 찾을 수 없음(404)
- **원인** : 로컬에서 요청하는 주체(vite)와 배포 버전에서 요청하는 주체(nginx) 가 달라 각각 설정을 따로 해줘야 함 ( 서버와의 통신은 항상 웹서버(nginx)를 통해서 한다고 생각 해줘야 할 듯?  )
- **과정**
	1. 로컬에서는 서버에서 받은 경로값을 200~ 서버 ip:port 에 직접 붙여서 주소에 직접 요청을 보내는 방식으로 사용
	2. 해당 방식을 사용하면 로컬에서는 작동 하지만 배포된 화면의 img 태그의 src 속성에서는 작동하지 않음
		- src 속성에 / 부터 시작하는 경로가 들어가면 자동으로 window.location.origin 이 주입 되어 요청된다. 
		- 하지만 현재 방식은 외부 접근이 가능한 nodePort를 가진 k8s service 에만 해당한 방식이며, 각 환경에 설치되는 대상 서버를 각각 변경해줘야 한다.
		- k8s service 이름으로 api 요청 중인 현재 방식으로는 사용할 수 없음
		- ( 단순 http://ip~ 적용 했을 때는 안 되는 것 같았는데 이건 테스트 필요)
			- ![[Pasted image 20250630154124.png]]
			- 위 방식으로 적용했을 때는 차단됨 뜸 -> 아마 html 에서 직접 보내는 요청은 차단시키는 듯(보안?)
	3. img 태그에 적용된 이미지 경로 또한 서버에 요청을 해서 로딩하는 방식이기 때문에 nginx를 거쳐서 요청이 필요함
	4. 또한, 모든 static 요청에 대해 공통으로 처리 필요

- **해결**
	1. ![[Pasted image 20250630155548.png]]
		- 기존 davis api를 요청하던 방식으로 /static 으로 시작하는 요청에 대한 nginx 설정 적용
		- 이렇게 하게 되면 jade-backend(Jade-Davis 공통 Gateway 주소(upstream)) 를 공통으로 사용해 davis의 static 파일 요청을 전송할 수 있게 된다.
		- jade-backend(Gateway) 에서 /davis-lite 요청을 파악하고 davis-list 의 /static 으로 요청 우회
	
	2. ![[Pasted image 20250630145647.png]]
		- 미리보기가 필요한 화면에서는 위와 같이 /davis-lite 를 명시해 nginx에서 요청을 jade-backend(Gateway) 에 보내고, Gateway 에서 클라이언트가 요청하는 대상이 davis 의 static 파일 요청이라는 것을 알 수 있도록 설정한다.